## Contact

Rik Arends: @rikarends on twitter, https://fosstodon.org/@rikarends#

Eddy Bruel: @ejpbruel on twitter

Sebastian Michailidis: @SebMichailidis on twitter

Our discord channel for Makepad:
https://discord.gg/adqBRq7Ece

Most recent talk about makepad: https://www.youtube.com/watch?v=rC4FCS-oMpg

# Makepad

## Overview

This is the repository for Makepad, a new way to build UIs in Rust for both native and the web.

Makepad consists of Makepad Framework and Makepad Studio.

Makepad Framework is our UI framework. It consists of multiple crates, but the top level crate is [makepad-widgets](https://crates.io/crates/makepad-widgets). For a further explanation of Makepad Framework, please see the README for that crate.

Makepad Studio is a prototype of an IDE that we've built using Makepad Framework. It's still under heavy development, but our eventual goal with Makepad Studio is to create an IDE that enables the design of an application to be changed at runtime. The main crate for Makepad Studio is [makepad-studio](https://crates.io/crates/makepad-studio). Please see the README for that crate for more.

Demo links:

[makepad-example-fractal-zoom](https://makepad.nl/makepad/examples/fractal_zoom/src/index.html)

[makepad-example-ironfish](https://makepad.nl/makepad/examples/ironfish/src/index.html)

[makepad-example-simple](https://makepad.nl/makepad/examples/simple/src/index.html)


### Prerequisites

To build the Makepad crates you first need to install Rust.
[https://www.rust-lang.org/tools/install](https://www.rust-lang.org/tools/install)

Our native builds work on the stable Rust toolchain. However, some of the errors generated by Makepad at runtime (particulary those originating in our DSL) do not contain line information unless you use the nightly Rust toolchain. Moreover, our web builds only work on nightly for now. For this reason, we recommend that you build Makepad using the nightly Rust toolchain.

For the non standard build targets (apple ios, apple tvos, android, wasm) we have a buildtool called 'cargo-makepad' that you need to install.

Install it from a local clone of the [repo](https://github.com/makepad/makepad):

```cargo install --path=./tools/cargo_makepad```

Or install it from crates.io (the last published version, it may be older than the repo):

```cargo install cargo-makepad```

The way how you've installed `cargo-makepad` will affect how you will install Makepad studio, if you
choose to use it (more later).

Now this tool can be used to install toolchains per platform needed

```cargo makepad wasm install-toolchain```

```cargo makepad apple ios install-toolchain```

```cargo makepad apple tvos install-toolchain```


```cargo makepad android --abi=all install-toolchain```

## Running makepad studio

Makepad studio allows you to easily build and view the examples, and it uses cargo-makepad internally so be sure to install cargo-makepad as shown above.

If you've installed `cargo-makepad` from a local clone of the repo, then either
- build & run Makepad studio from the local clone:
  
  ```cargo run -p makepad-studio --release```
- or install `makepad-studio` from the local clone:
  
  ```cargo install --path=./studio```

Or install it from crates.io (the last published version, it may be older than the repo)::

```cargo install makepad-studio```

If you build the wasm applications, you can open it on:

<http://127.0.0.1:8010>

## Build & Run Commands

[Makepad](https://github.com/makepad/makepad) is a cross-platform UI framework written in Rust.
It is in active development, but is already usable to build quick prototypes and simple (or even complicated UI) applications.

One of the key features of the Makepad is its ability to simply, and quickly, build and run applications on multiple platforms, including MacOS, Windows, Linux, Android, iOS, and WebAssembly.

Here are the current/latest instructions on how to build and run Makepad applications on the different platforms.

## Assumptions

We will assume the following:
Name of application: **`makepad-example-simple`**

It can be changed to any one of the existing example apps in the [*Makepad* examples folder](https://github.com/makepad/makepad//tree/master/examples).

## Build & Run Instructions

Follow step 1 commands below for initial setup of the Makepad build and run environment.
After step 2, you may choose any one or more of the platforms you're interested in building for.

## 1. Setup Makepad

Replace `projects` with your own directory name.

```bash
cd ~/projects
```

### Clone the Makepad repository

```bash
git clone https://github.com/makepad/makepad.git
```

or

```bash
git clone git@github.com:makepad/makepad.git
```

### Change to latest 'rik' branch (Optional)

```bash
cd ~/projects/makepad
git branch rik
```

### Install makepad subcommand for cargo

```bash
cd ~/projects/makepad
cargo install --path ./tools/cargo_makepad
```

### Install platform toolchains

```bash
rustup toolchain install nightly
```

## 2. Go To Examples folder (Optional)

```bash
cd ~/projects/makepad/examples
ls -l
```

All examples in this directory have the application name of `makepad-example-` prefix plus the name of directory.

## 3. MacOS / PC

Running on Desktop is the quickest way to try out an example app.

```bash
cd ~/projects/makepad/examples/simple
cargo run
```

or

```bash
cd ~/projects/makepad
cargo run -p makepad-example-simple
```

And there should be a desktop application window now running (may need to click on the icon on MacOS's Dock to show it)

## 4. Android Build

### Install Android toolchain (First time)

```bash
cargo makepad android install-toolchain
```

### Install app on Android device or Android emulator

Open either the Android emulator or connect to a real Android device
use `adb` command to make sure there's a single device connected properly, then install and run as below:

```bash
cd ~/projects/makepad
cargo makepad android run -p makepad-example-simple --release
```

The application will be installed and launch on either the emulator or device.

## 5. iOS Setup & Install

### Install iOS toolchain (First time)

```bash
xcode-select --install
cargo makepad apple ios install-toolchain
```

### Install app on Apple devivce or iOS simulator

### iOS Setup

For iOS, the process is slightly more complicated. The steps involved are:

1. Enable your iPhone's Developer Mode, please see instructions here: [Enable Developer Mode](https://www.delasign.com/blog/how-to-turn-on-developer-mode-on-an-iphone/)
1. Setup an Apple Developer account
1. Setup an empty skeleton project in XCode
    1. File -> New -> Project to create a new "App"
    1. Set the Product Name as **`makepad-example-simple`** (used in --app later)
    1. Set the Organization Identifier to a value of your choice, for this example we will use **`my.test`** (used in --org later)
    1. Setup the Project Signing & Capabilities to select the proper team account
1. In XCode, Build/Run this project to install and run the app on the simulator and device
1. Once the simulator and device has the "skeleton" app installed and running properly, then it is ready for Makepad to install its application.

### Makepad Install

We will run the `cargo makepad apple ios` command, similar to Android build above, but there are some 2 to 6 additional parameters that need to be filled in:

**`--org`**

First few parts of the organization identifier. Usually in the form of *com.somecompany* or *org.orgname*, etc.
This is the same value used to setup the initial skeleton app above. For this example:
> `my.test`

**`--app`**

The name of the application or the project. This is the same as the Product Name used to setup the initial skeleton app above. In this case:
> `makepad-example-simple`

### Install app on iOS simulator

```bash
cd ~/projects/makepad
cargo makepad apple ios \
  --org=my.test \
  --app=makepad-example-simple \
  run-sim -p makepad-example-simple --release
```

### Install app on iOS device

For installing on real device, the process is more involved due to possibility of multiple profiles and signing identities and target devices. For this reason, Makepad provides a list command to show all the local provisioning profiles, signing identities and connected devices, which can be used as the value for the subsequent command arguments.

For example, first run the following command:

```bash
cd ~/projects/makepad
cargo makepad apple list
```

This command will print out the list of all provisioning profiles, signing identities, and device identifiers on the current system. The user has to decide and choose the ones that he/she needs to use for each type.

Once decided, run the folloiwng command and fill in the **unique starting characters** chosen from the output.

```bash
cargo makepad apple ios \
 --profile=unique-starting-hex-string-of-provisioning-profiles \
 --cert=UNIQUE_STARTING_HEX_STRING-of-signing-certificates \
 --device-identifier=UNIQUE-STARTING-HEX-STRING-of-devices \
 --org=my.test \
 --app=makepad-example-simple \
 run-device -p makepad-example-simple –release
 
```

The application will be installed and launched on either the emulator or real device. (Make sure the device is connected and unlocked)

## 6. WASM Build

Running the Makepad application as a WASM build is as simple as a single command. The sript will automatically generate the necessary index.html and other files and also start a local webserver at port 8010. After running the command below, just open your browser to <http://127.0.0.1:8010/> in order for the app to load and run.

### Install WASM toolchain (First time)

```bash
cargo makepad wasm install-toolchain
```

### Install app as WASM binary for browsers

```bash
cargo makepad wasm run -p makepad-example-simple --release
```

### Cross-origin headers for WASM for browsers

For WASM to work in browsers, your web server must

- serve the MIME types correctly (as is common), and
- set the following two headers.
  ```
  Cross-Origin-Embedder-Policy: require-corp
  Cross-Origin-Opener-Policy: same-origin
  ```
  This is NOT common on public web servers like GitHub Pages. And it can't be set with `<meta
  http-equiv="..." content="..."></meta>` in `index.html`.
  
  A workaround - but possibly for non-private browser mode only: use
  [gzuidhof/coi-serviceworker](https://github.com/gzuidhof/coi-serviceworker):
  
  1. Let's say that you use Makepad's `experiments/html_experiment`. Build it with `cargo makepad
     wasm build -p makepad-experiment-html`.
  2. Copy
     [coi-serviceworker.min.js](https://github.com/gzuidhof/coi-serviceworker/blob/master/coi-serviceworker.min.js)
     (or
     [coi-serviceworker.js](https://github.com/gzuidhof/coi-serviceworker/blob/master/coi-serviceworker.js))
     to `target/makepad-wasm-app/debug/makepad-experiment-html`.
  3. Edit `target/makepad-wasm-app/debug/makepad-experiment-html/index.html` and under `<head>` add:
     `<script src="coi-serviceworker.min.js"></script>` (or `<script
     src="coi-serviceworker.js"></script>`).
  4. If use build a release with `cargo makepad wasm build -p makepad-experiment-html --release`,
     then the build directory is `makepad/target/makepad-wasm-app/release/makepad-experiment-html`
     instead.
  5. If there is any initiation, it will be run twice. To control that, follow
     [gzuidhof/coi-serviceworker#14](https://github.com/gzuidhof/coi-serviceworker/issues/14).
  6. If this works well, incorporate it to Makepad's `tools/cargo_makepad/src/wasm/compile.rs` and
     `platform/src/os/web/` and create a pull request.
---

## Makepad Commands Quick Reference

### Cargo Tools Installations

These are commands that need to be run at least once initially to setup Makepad development environments.
They should also be run once in a while or when there are updates to the cargo_makepad script.

```bash
rustup update
rustup install nightly
rustup toolchain install nightly

cd ~/projects/makepad
cargo install --path ./tools/cargo_makepad
cargo makepad android install-toolchain
cargo makepad apple ios install-toolchain
cargo makepad apple tv install-toolchain
cargo makepad wasm install-toolchain

```

### Android

Command for installing the app onto an iOS Simulator.

```bash
cargo makepad android run -p makepad-example-simple --release

cargo makepad android run -p makepad-example-fractal-zoom --release

cargo makepad android run -p makepad-example-ironfish --release

cargo makepad android run -p makepad-example-news-feed --release
```

### iOS Simulator

Command for installing the app onto an iOS Simulator.

```bash
cargo makepad apple ios --org=my.test --app=makepad-example-simple run-sim -p makepad-example-simple --release

cargo makepad apple ios --org=my.test --app=makepad-example-fractal-zoom run-sim -p makepad-example-fractal-zoom --release

cargo makepad apple ios --org=my.test --app=makepad-example-ironfish run-sim -p makepad-example-ironfish --release

cargo makepad apple ios --org=my.test --app=makepad-example-news-feed run-sim -p makepad-example-news-feed --release
```

### iOS Device

Command for installing the app onto a physical iOS device.

**See Step 5 above for more detailed instructions.**

```bash
cargo makepad apple ios --org=my.test --profile=ABC --cert=DEF --device=MyiPhone --app=makepad-example-simple run-device -p makepad-example-simple --release

cargo makepad apple ios --org=my.test --profile=ABC --cert=DEF --device=MyiPhone --app=makepad-example-fractal-zoom run-device -p makepad-example-fractal-zoom --release

cargo makepad apple ios --org=my.test --profile=ABC --cert=DEF --device=MyiPhone --app=makepad-example-ironfish -run-device -p makepad-example-ironfish --release

cargo makepad apple ios --org=my.test --profile=ABC --cert=DEF --device=MyiPhone --app=makepad-example-news-feed run-device -p makepad-example-news-feed --release
```

### Cargo Check Builds

Command to check that the compilation passes for all Makepad supported platforms:
(Will use 100% CPU and cause hang machine, only try on high-end systems)

```bash
cargo makepad check install-toolchain
cargo makepad check all
```
